---
import type { CollectionEntry } from "astro:content";
import FormattedDate from "./FormattedDate.astro";

interface Props {
  post: CollectionEntry<"blog">;
}

const { post } = Astro.props;
const { title, description, pubDate, price, downloads } = post.data;

// Format price in cents to dollars
const formatPrice = (cents: number) => {
  return `$${(cents / 100).toFixed(2)}`;
};

const isPaid = price !== undefined && price > 0;
const downloadCount = downloads?.length || 0;
---

<article class="blog-card">
	<a href={`/blog/${post.id}/`}>
		<h3 class="title">{title}</h3>
		<p class="date">
			<FormattedDate date={pubDate} />
		</p>
		{description && <p class="description">{description}</p>}

		<div class="badges">
			{isPaid ? (
				<>
					<span class="badge badge-paid">{formatPrice(price!)}</span>
					{downloadCount > 0 && (
						<span class="badge badge-downloads">
							{downloadCount} {downloadCount === 1 ? 'Download' : 'Downloads'}
						</span>
					)}
				</>
			) : (
				<span class="badge badge-free">FREE</span>
			)}
		</div>
	</a>
</article>

<style>
	.blog-card {
		background: white;
		border: 1px solid rgb(var(--gray-light));
		border-radius: 8px;
		padding: 1.5rem;
		transition: all 0.2s ease;
	}

	.blog-card:hover {
		border-color: rgb(var(--accent));
		box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
	}

	.blog-card a {
		text-decoration: none;
		color: inherit;
		display: block;
	}

	.title {
		margin: 0 0 0.5rem 0;
		color: rgb(var(--black));
		line-height: 1.3;
		font-size: 1.4rem;
		font-weight: 600;
	}

	.blog-card:hover .title {
		color: rgb(var(--accent));
	}

	.date {
		margin: 0 0 1rem 0;
		color: rgb(var(--gray));
		font-size: 0.9rem;
	}

	.description {
		margin: 0 0 1rem 0;
		color: rgb(var(--gray-dark));
		line-height: 1.5;
	}

	.badges {
		display: flex;
		gap: 0.5rem;
		flex-wrap: wrap;
	}

	.badge {
		display: inline-block;
		padding: 0.25rem 0.75rem;
		border-radius: 4px;
		font-size: 0.85rem;
		font-weight: 500;
		text-transform: uppercase;
		letter-spacing: 0.5px;
	}

	.badge-free {
		background: #d1fae5;
		color: #065f46;
	}

	.badge-paid {
		background: #dbeafe;
		color: #1e40af;
	}

	.badge-downloads {
		background: #ede9fe;
		color: #5b21b6;
	}
</style>
